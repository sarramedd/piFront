<div class="container-scroller">
    <app-sidebar-back></app-sidebar-back>
  
    <div class="container-fluid page-body-wrapper">
      <app-navbar></app-navbar>
  
      <div class="main-panel" style="height: 100vh; overflow-y: auto; padding-top: 0;">
        <div class="content-wrapper">
          <div class="page-header">
            <h3 class="page-title">Liste des Utilisateurs</h3>
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">Tables</a></li>
                <li class="breadcrumb-item active" aria-current="page">Liste des utilisateurs</li>
              </ol>
            </nav>
          </div>
  
          <!-- Messages d'erreur -->
          <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
            {{ errorMessage }}
            <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
          </div>
  
          <!-- Indicateur de chargement -->
          <div *ngIf="isLoading" class="text-center my-4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Chargement...</span>
            </div>
            <p *ngIf="currentAction">{{ getActionName(currentAction) }} en cours...</p>
          </div>
  
          <div class="row" *ngIf="!isLoading">
            <div class="col-lg-12 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title">Utilisateurs</h4>
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>Nom</th>
                          <th>Email</th>
                          <th>Statut</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let user of users">
                          <td>{{ user.name }}</td>
                          <td>{{ user.email }}</td>
                          <td>
                            <span class="badge" 
                                  [ngClass]="{
                                    'bg-success': user.status === 'Active',
                                    'bg-danger': user.status === 'Banned'
                                  }">
                              {{ user.status }}
                            </span>
                          </td>
                          <td>
                            <div class="btn-group" role="group">
                              <!-- Bannir -->
                              <button *ngIf="user.status !== 'Banned'" 
                                      class="btn btn-warning btn-sm me-2" 
                                      (click)="confirmAction('ban', user.id)"
                                      [disabled]="isLoading">
                                <i class="bi bi-slash-circle"></i> Bannir
                              </button>
                              
                              <!-- Débannir -->
                              <button *ngIf="user.status === 'Banned'" 
                                      class="btn btn-success btn-sm me-2" 
                                      (click)="confirmAction('unban', user.id)"
                                      [disabled]="isLoading">
                                <i class="bi bi-check-circle"></i> Débannir
                              </button>
                              
                              <!-- Supprimer -->
                              <button class="btn btn-danger btn-sm" 
                                      (click)="confirmAction('delete', user.id)"
                                      [disabled]="isLoading">
                                <i class="bi bi-trash"></i> Supprimer
                              </button>
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <app-footer-back></app-footer-back>
      </div>
    </div>
  </div>